#!/usr/bin/env bash
# Configures Nginx with a custom HTTP response header

# Update package list and install Nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Configure Nginx default site to add custom header
config_file="/etc/nginx/sites-available/default"

# Backup the original config
cp "$config_file" "$config_file.bak"

# Add custom header to server block if not already present
if ! grep -q "X-Served-By" "$config_file"; then
    # Add the header inside the server block after the server_name directive
    sed -i "/server_name _;/a \\\tadd_header X-Served-By \$hostname;" "$config_file"
fi

# Test Nginx configuration
nginx -t

# Restart Nginx to apply changes
service nginx restart
