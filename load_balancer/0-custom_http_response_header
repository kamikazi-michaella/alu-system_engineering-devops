#!/usr/bin/env bash
# Configures Nginx with a custom HTTP response header

# Update package list and install Nginx if not already installed
apt-get update
apt-get install -y nginx

# Get the hostname of the server
# shellcheck disable=SC2154
hostname=$(hostname)

# Configure Nginx to add custom header
# Add the custom header configuration to the http block
config_line="add_header X-Served-By \$hostname;"

# Check if the custom header already exists in the config
if ! grep -q "X-Served-By" /etc/nginx/nginx.conf; then
    # Add the custom header in the http block
    sed -i "/http {/a \\\t$config_line" /etc/nginx/nginx.conf
fi

# Ensure Nginx is enabled and restart it to apply changes
systemctl enable nginx
systemctl restart nginx

# Verify Nginx is running
systemctl status nginx
